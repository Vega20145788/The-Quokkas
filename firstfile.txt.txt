import { useState } from "react";
import { Scene } from "@/components/game/Scene";
import { Controls } from "@/components/game/Controls";
import { Button } from "@/components/ui/button";
import { motion } from "framer-motion";
type GameState = 
  | "START" | "SPHINX_INTRO" | "SPHINX_WAIT" | "SPHINX_LOSE" | "SPHINX_WIN"
  | "DRAGON_INTRO" | "DRAGON_LOSE" | "DRAGON_WIN"
  | "DEER_INTRO" | "DEER_FEED" | "DEER_LOSE"
  | "KITSUNE_INTRO" | "KITSUNE_WIN" | "KITSUNE_LOSE"
  | "FINAL_WIN";
export default function Game() {
  const [gameState, setGameState] = useState<GameState>("START");
  const [clues, setClues] = useState<string[]>([]);
  const restart = () => {
    setGameState("START");
    setClues([]);
  };
  const addClue = (clue: string, nextState: GameState) => {
    setClues(prev => {
      if (!prev.includes(clue)) return [...prev, clue];
      return prev;
    });
    setGameState(nextState);
  };
  const renderScene = () => {
    switch (gameState) {
      case "START":
        return (
          <Scene
            image="/hallway.png"
            text='âœ¨ You find yourself in a mystical castle hallway with 4 glowing doors. âœ¨ A voice echoes: "Go through these doors one by one, and find the answer to the way out". Each door tests a different virtue.'
          >
            <div className="flex flex-col items-center gap-6">
              <Controls
                options={[
                  { label: "ðŸšª Door 1: Patience", onClick: () => setGameState("SPHINX_INTRO") },
                  { label: "ðŸšª Door 2: Harmony", onClick: () => setGameState("DRAGON_INTRO") },
                  { label: "ðŸšª Door 3: Kindness", onClick: () => setGameState("DEER_INTRO") },
                  { label: "ðŸšª Door 4: Respect", onClick: () => setGameState("KITSUNE_INTRO") },
                ]}
              />
              {clues.length > 0 && (
                <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} className="mt-8 p-6 bg-primary/10 backdrop-blur-xl rounded-xl border-2 border-primary/30 text-center shadow-[0_0_30px_rgba(var(--primary),0.1)]">
                  <p className="text-sm uppercase tracking-[0.2em] text-primary font-heading mb-4">ðŸ“œ Inventory: Clues Found</p>
                  <div className="flex gap-3 justify-center flex-wrap">
                    {clues.map((c, i) => (
                      <span key={i} className="px-4 py-2 bg-black/60 rounded-lg border border-primary/20 text-xs text-white font-mono shadow-inner">{c}</span>
                    ))}
                  </div>
                  {clues.length === 4 && (
                    <Button size="lg" className="mt-6 bg-primary text-black hover:bg-white hover:scale-105 transition-all duration-300 font-heading px-8 py-6 text-xl shadow-[0_0_20px_rgba(var(--primary),0.4)]" onClick={() => setGameState("FINAL_WIN")}>ðŸ”“ Combine Clues & Escape!</Button>
                  )}
                </motion.div>
              )}
            </div>
          </Scene>
        );
      // ... (Other cases follow similar logic for Sphinx, Dragon, Deer, and Kitsune)
    }
  };
  return <div className="min-h-screen bg-background text-foreground font-body">{renderScene()}</div>;
}
2. Scene Component (client/src/components/game/Scene.tsx)
This component creates the atmospheric background and the cinematic narrative text box.
import { motion } from "framer-motion";
import { ReactNode } from "react";
export function Scene({ image, text, children }: { image: string, text: string, children?: ReactNode }) {
  return (
    <div className="relative w-full h-screen flex flex-col items-center justify-center overflow-hidden bg-black">
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 1 }} className="absolute inset-0 z-0">
        <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent z-10" />
        <img src={image} alt="Scene" className="w-full h-full object-cover opacity-80" />
      </motion.div>
      <div className="relative z-20 w-full max-w-4xl p-6 flex flex-col items-center gap-8">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5, duration: 0.8 }} className="bg-black/60 backdrop-blur-md border border-white/10 p-8 rounded-lg shadow-2xl max-w-2xl text-center text-white">
          <p className="font-heading text-xl md:text-2xl leading-relaxed text-balance drop-shadow-md">{text}</p>
        </motion.div>
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1.5, duration: 0.5 }} className="w-full flex flex-col items-center gap-4">{children}</motion.div>
      </div>
    </div>
  );
}
3. Controls Component (client/src/components/game/Controls.tsx)
This defines the styled yellow choice buttons.
import { Button } from "@/components/ui/button";
import { motion } from "framer-motion";
export function Controls({ options }: { options: any[] }) {
  return (
    <div className="flex flex-wrap justify-center gap-4 w-full max-w-3xl">
      {options.map((option, index) => (
        <motion.div key={index} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 1.5 + index * 0.1 }} className="w-full sm:w-auto">
          <Button 
            onClick={option.onClick}
            variant={option.variant || "default"}
            size="lg"
            className="w-full sm:min-w-[200px] text-lg py-6 font-heading border-primary/40 hover:border-primary/80 bg-primary/20 hover:bg-primary/30 transition-all duration-300 shadow-lg hover:shadow-primary/20 text-primary"
        {option.label}
      </Button>
    </motion.div>
  ))}
</div>
